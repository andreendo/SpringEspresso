<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Detalhes da Sessão</title>
  <link rel="stylesheet" th:href="@{/css/main.css}"/>
  <style>
    .details-card { text-align: left; margin-bottom: 25px; background-color: #fff; padding: 25px; border: 1px solid var(--cinza-claro); border-radius: var(--borda-arredondada); }
    .details-card h3 { text-align: left; margin-top: 0; }
    .details-card p { margin: 10px 0; }
    .details-card strong { color: var(--cafe-escuro); }
    .action-forms { display: flex; justify-content: space-between; align-items: flex-start; gap: 20px; }
    .action-forms .card { flex-grow: 1; }
  </style>
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>

<div class="wrapper">
  <h1>Detalhes da Sessão de Teste</h1>

  <div th:if="${mensagemSucesso}" class="message-box success">
    <p th:text="${mensagemSucesso}"></p>
  </div>

  <div class="details-card">
    <h3>Informações Gerais</h3>
    <p><strong>Projeto:</strong> <a th:href="@{/projetos/listar}" th:text="${sessao.projeto.nome}"></a></p>
    <p><strong>Tester:</strong> <span th:text="${sessao.tester.nome}"></span></p>
    <p><strong>Estratégia:</strong> <span th:text="${sessao.estrategia.nome}"></span></p>
    <p><strong>Duração Definida:</strong> <span th:text="${sessao.duracao.toMinutes()} + ' minutos'"></span></p>
    <p><strong>Status Atual:</strong> <span th:text="${sessao.status.name()}"></span></p>
    <p><strong>Descrição/Objetivos:</strong></p>
    <p style="white-space: pre-wrap; background-color: #f9f9f9; padding: 10px; border-radius: 5px;" th:text="${sessao.descricao}"></p>
  </div>

  <div class="action-forms">
    <div class="card" th:if="${sessao.status.name() != 'FINALIZADO'}">
      <h3>Mudar Status</h3>
      <form th:action="@{/sessoes/atualizarStatus}" method="post">
        <input type="hidden" name="sessaoId" th:value="${sessao.id}" />
        <select name="novoStatus" required>
          <option value="">-- Selecione --</option>
          <option th:each="st : ${todosStatus}" th:if="${st.name() != sessao.status.name()}"
                  th:value="${st}" th:text="${st.name()}"></option>
        </select>
        <button type="submit" class="button button-primary">Atualizar</button>
      </form>
    </div>

    <div class="card">
      <h3>Remover Sessão</h3>
      <form th:action="@{/sessoes/deletar}" method="post">
        <input type="hidden" name="sessaoId" th:value="${sessao.id}" />
        <input type="hidden" name="projetoId" th:value="${sessao.projeto.id}" />
        <p>Esta ação não pode ser desfeita.</p>
        <button type="submit" class="button button-danger"
                onclick="return confirm('Tem certeza que deseja remover esta sessão?');">
          Deletar Sessão
        </button>
      </form>
    </div>
  </div>

  <div class="details-card">
    <h3>Histórico de Status</h3>
    <table class="table">
      <thead><tr><th>De</th><th>Para</th><th>Data/Hora</th></tr></thead>
      <tbody>
      <tr th:each="h : ${sessao.historico}">
        <td th:text="${h.statusAnterior != null ? h.statusAnterior.name() : 'Criação'}"></td>
        <td th:text="${h.statusNovo.name()}"></td>
        <td th:text="${#temporals.format(h.dataHora, 'dd/MM/yyyy HH:mm:ss')}"></td>
      </tr>
      </tbody>
    </table>
  </div>

  <p><a th:href="@{/sessoes/projeto/{id}(id=${sessao.projeto.id})}" class="button button-secondary">Voltar para a Lista de Sessões</a></p>
</div>

<div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html>